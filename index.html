-04.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple WebXR Experience</title>
    <style>
        body { margin: 0; padding: 0; overflow: hidden; }
        canvas { display: block; }
        #vrButton {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 24px;
            background: #4285f4;
            color: white;
            font-family: Arial, sans-serif;
            font-size: 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <button id="vrButton">Enter VR</button>

    <script type="module">
        import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js';
        import { VRButton } from 'https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/webxr/VRButton.js';
        import { XRControllerModelFactory } from 'https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/webxr/XRControllerModelFactory.js';
        
        let camera, scene, renderer;
        let controller1, controller2;
        let controllerGrip1, controllerGrip2;
        
        // Player movement
        const playerVelocity = new THREE.Vector3();
        const playerDirection = new THREE.Vector3();
        const playerPosition = new THREE.Vector3(0, 1, 0);
        
        init();
        animate();
        
        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x505050);
            
            // Camera setup
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 100);
            camera.position.set(0, 1.6, 3);
            
            // Lighting
            const ambientLight = new THREE.AmbientLight(0x404040);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
            directionalLight.position.set(1, 6, 1).normalize();
            scene.add(directionalLight);
            
            // Floor
            const floorGeometry = new THREE.PlaneGeometry(20, 20);
            const floorMaterial = new THREE.MeshStandardMaterial({
                color: 0x156289,
                roughness: 0.4,
                metalness: 0.2
            });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            floor.receiveShadow = true;
            scene.add(floor);
            
            // Add some objects to the scene
            for (let i = 0; i < 10; i++) {
                const geometry = new THREE.BoxGeometry(0.5, 0.5, 0.5);
                const material = new THREE.MeshStandardMaterial({
                    color: Math.random() * 0xffffff,
                    roughness: 0.7,
                    metalness: 0.2
                });
                const cube = new THREE.Mesh(geometry, material);
                cube.position.x = Math.random() * 10 - 5;
                cube.position.y = 0.25;
                cube.position.z = Math.random() * 10 - 5;
                cube.castShadow = true;
                scene.add(cube);
            }
            
            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.xr.enabled = true;
            document.body.appendChild(renderer.domElement);
            
            // VR Button
            document.getElementById('vrButton').addEventListener('click', function() {
                document.body.appendChild(VRButton.createButton(renderer));
            });
            
            // Controllers
            const controllerModelFactory = new XRControllerModelFactory();
            
            // Controller 1
            controller1 = renderer.xr.getController(0);
            scene.add(controller1);
            
            controllerGrip1 = renderer.xr.getControllerGrip(0);
            controllerGrip1.add(controllerModelFactory.createControllerModel(controllerGrip1));
            scene.add(controllerGrip1);
            
            // Controller 2
            controller2 = renderer.xr.getController(1);
            scene.add(controller2);
            
            controllerGrip2 = renderer.xr.getControllerGrip(1);
            controllerGrip2.add(controllerModelFactory.createControllerModel(controllerGrip2));
            scene.add(controllerGrip2);
            
            // Controller input events for thumbstick movement
            controller1.addEventListener('connected', function(event) {
                setupController(event.data, 0);
            });
            
            controller2.addEventListener('connected', function(event) {
                setupController(event.data, 1);
            });
            
            window.addEventListener('resize', onWindowResize);
        }
        
        function setupController(data, controllerIndex) {
            // Store the controller index for reference
            const controller = controllerIndex === 0 ? controller1 : controller2;
            controller.userData.controllerIndex = controllerIndex;
        }
        
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        function getThumbstickValues() {
            const gamepads = navigator.getGamepads ? navigator.getGamepads() : [];
            const movementSpeed = 0.05;
            playerVelocity.set(0, 0, 0);
            
            for (let i = 0; i < gamepads.length; i++) {
                const gamepad = gamepads[i];
                if (gamepad && (gamepad.id.includes('Oculus') || gamepad.id.includes('OpenVR') || gamepad.id.includes('Spatial'))) {
                    // Read left thumbstick values (usually axes[2] and axes[3])
                    if (Math.abs(gamepad.axes[2]) > 0.1) {
                        playerVelocity.x = gamepad.axes[2] * movementSpeed;
                    }
                    
                    if (Math.abs(gamepad.axes[3]) > 0.1) {
                        playerVelocity.z = gamepad.axes[3] * movementSpeed;
                    }
                }
            }
        }
        
        function updatePlayerPosition() {
            if (!renderer.xr.isPresenting) return;
            
            const xrCamera = renderer.xr.getCamera();
            
            // Get forward and right directions from the camera
            playerDirection.z = Math.cos(xrCamera.rotation.y);
            playerDirection.x = Math.sin(xrCamera.rotation.y);
            playerDirection.normalize();
            
            const rightDirection = new THREE.Vector3();
            rightDirection.crossVectors(new THREE.Vector3(0, 1, 0), playerDirection).normalize();
            
            // Apply movement in the direction the camera is facing
            playerPosition.x += playerVelocity.x * rightDirection.x + playerVelocity.z * playerDirection.x;
            playerPosition.z += playerVelocity.x * rightDirection.z + playerVelocity.z * playerDirection.z;
            
            // Update XR camera position
            xrCamera.position.x = playerPosition.x;
            xrCamera.position.z = playerPosition.z;
        }
        
        function animate() {
            renderer.setAnimationLoop(render);
        }
        
        function render() {
            getThumbstickValues();
            updatePlayerPosition();
            renderer.render(scene, camera);
        }
    </script>
</body>
</html>
